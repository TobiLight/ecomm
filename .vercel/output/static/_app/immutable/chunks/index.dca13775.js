import{p as E}from"./parse.7d180a0f.js";import{c as s,a as v}from"./singletons.3ddd995c.js";const w=s("invalidate_all"),D=s("before_navigate"),F=s("after_navigate");function L(t){return v.apply_action(t)}function T(t){const n=JSON.parse(t);return n.data&&(n.data=E(n.data)),n}function g(t){return HTMLElement.prototype.cloneNode.call(t)}function H(t,n=()=>{}){const l=async({action:e,result:c,reset:i=!0,invalidateAll:r=!0})=>{c.type==="success"&&(i&&HTMLFormElement.prototype.reset.call(t),r&&await w()),(location.origin+location.pathname===e.origin+e.pathname||c.type==="redirect"||c.type==="error")&&L(c)};async function u(e){var p,b,h,y;if(((p=e.submitter)!=null&&p.hasAttribute("formmethod")?e.submitter.formMethod:g(t).method)!=="post")return;e.preventDefault();const i=new URL((b=e.submitter)!=null&&b.hasAttribute("formaction")?e.submitter.formAction:g(t).action),r=new FormData(t),d=(h=e.submitter)==null?void 0:h.getAttribute("name");d&&r.append(d,((y=e.submitter)==null?void 0:y.getAttribute("value"))??"");const m=new AbortController;let f=!1;const A=await n({action:i,cancel:()=>f=!0,controller:m,get data(){return r},formData:r,get form(){return t},formElement:t,submitter:e.submitter})??l;if(f)return;let o;try{const a=await fetch(i,{method:"POST",headers:{accept:"application/json","x-sveltekit-action":"true"},cache:"no-store",body:r,signal:m.signal});o=T(await a.text()),o.type==="error"&&(o.status=a.status)}catch(a){if((a==null?void 0:a.name)==="AbortError")return;o={type:"error",error:a}}A({action:i,get data(){return r},formData:r,get form(){return t},formElement:t,update:a=>l({action:i,result:o,reset:a==null?void 0:a.reset,invalidateAll:a==null?void 0:a.invalidateAll}),result:o})}return HTMLFormElement.prototype.addEventListener.call(t,"submit",u),{destroy(){HTMLFormElement.prototype.removeEventListener.call(t,"submit",u)}}}new TextEncoder;export{F as a,D as b,L as c,H as e,w as i};
